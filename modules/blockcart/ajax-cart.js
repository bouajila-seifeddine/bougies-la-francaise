function HoverWatcher(t){this.hovering=!1;var a=this;this.isHoveringOver=function(){return a.hovering},$(t).hover(function(){a.hovering=!0},function(){a.hovering=!1})}"undefined"==typeof baseUri&&"undefined"!=typeof baseDir&&(baseUri=baseDir);var ajaxCart={nb_total_products:0,overrideButtonsInThePage:function(){$(".ajax_add_to_cart_button").unbind("click").click(function(){var t=$(this).attr("rel").replace("nofollow","").replace("ajax_id_product_","");return"disabled"!=$(this).attr("disabled")&&ajaxCart.add(t,null,!1,this),!1}),$("#add_to_cart input").unbind("click").click(function(){return ajaxCart.add($("#product_page_product_id").val(),$("#idCombination").val(),!0,null,$("#quantity_wanted").val(),null),!1}),$("#cart_block_list .ajax_cart_block_remove_link").unbind("click").click(function(){var t=0,a=0,e=0,i=$($(this).parent().parent()).find("div[id^=deleteCustomizableProduct_]");if(i&&$(i).length&&$(i).each(function(){var i=$(this).attr("id").split("_");return"undefined"!=typeof i[1]?(t=parseInt(i[1]),a=parseInt(i[2]),"undefined"!=typeof i[3]&&(e=parseInt(i[3])),!1):void 0}),!t){var o=$(this).parent().parent().attr("id").replace("cart_block_product_","");o=o.replace("deleteCustomizableProduct_",""),ids=o.split("_"),a=parseInt(ids[0]),"undefined"!=typeof ids[1]&&(e=parseInt(ids[1]))}var r=$(this).parent().parent().attr("id").match(/.*_\d+_\d+_(\d+)/)[1];return ajaxCart.remove(a,e,t,r),!1})},expand:function(){$("#cart_block_list").hasClass("collapsed")&&($("#cart_block_summary").slideUp(200,function(){$(this).addClass("collapsed").removeClass("expanded"),$("#cart_block_list").slideDown({duration:450,complete:function(){$(this).addClass("expanded").removeClass("collapsed")}})}),$("#block_cart_expand").fadeOut("slow",function(){$("#block_cart_collapse").fadeIn("fast")}),$.ajax({type:"POST",headers:{"cache-control":"no-cache"},url:baseDir+"modules/blockcart/blockcart-set-collapse.php?rand="+(new Date).getTime(),async:!0,cache:!1,data:"ajax_blockcart_display=expand"}))},refresh:function(){$.ajax({type:"POST",headers:{"cache-control":"no-cache"},url:baseUri+"?rand="+(new Date).getTime(),async:!0,cache:!1,dataType:"json",data:"controller=cart&ajax=true&token="+static_token,success:function(t){ajaxCart.updateCart(t)},error:function(t,a,e){alert("TECHNICAL ERROR: \n\nDetails:\nError thrown: "+t+"\nText status: "+a)}})},collapse:function(){$("#cart_block_list").hasClass("expanded")&&($("#cart_block_list").slideUp("slow",function(){$(this).addClass("collapsed").removeClass("expanded"),$("#cart_block_summary").slideDown(450,function(){$(this).addClass("expanded").removeClass("collapsed")})}),$("#block_cart_collapse").fadeOut("slow",function(){$("#block_cart_expand").fadeIn("fast")}),$.ajax({type:"POST",headers:{"cache-control":"no-cache"},url:baseDir+"modules/blockcart/blockcart-set-collapse.php?rand="+(new Date).getTime(),async:!0,cache:!1,data:"ajax_blockcart_display=collapse&rand="+(new Date).getTime()}))},updateCartInformation:function(t,a){ajaxCart.updateCart(t),a?$("#add_to_cart input").removeAttr("disabled").addClass("exclusive").removeClass("exclusive_disabled"):$(".ajax_add_to_cart_button").removeAttr("disabled")},add:function(t,a,e,i,o,r){return e&&!checkCustomizations()?void alert(fieldRequired):(emptyCustomizations(),e?($("#add_to_cart input").attr("disabled",!0).removeClass("exclusive").addClass("exclusive_disabled"),$(".filled").removeClass("filled")):$(i).attr("disabled",!0),$("#cart_block_list").hasClass("collapsed")&&this.expand(),void $.ajax({type:"POST",headers:{"cache-control":"no-cache"},url:baseUri+"?rand="+(new Date).getTime(),async:!0,cache:!1,dataType:"json",data:"controller=cart&add=1&ajax=true&qty="+(o&&null!=o?o:"1")+"&id_product="+t+"&token="+static_token+(parseInt(a)&&null!=a?"&ipa="+parseInt(a):""),success:function(o,s,n){r&&!o.errors&&WishlistAddProductCart(r[0],t,a,r[1]);var c=$(i).parent().parent().find("a.product_image img,a.product_img_link img");c.length||(c=$("#bigpic"));var d=c.clone(),l=c.offset();l.right=$(window).innerWidth()-l.left-c.width(),d.length&&d.css({position:"absolute",top:l.top,right:l.right});var u=(d.offset(),$("#cart_block"));$("#cart_block")[0]&&$("#cart_block").offset().top&&$("#cart_block").offset().left||(u=$("#shopping_cart"));var _=u.offset();_.right=$(window).innerWidth()-_.left-u.width(),void 0!=_&&d.length?(d.appendTo("body"),d.css({position:"absolute",top:l.top,right:l.right,zIndex:4242}).animate({width:.66*c.attr("width"),height:.66*c.attr("height"),opacity:.2,top:_.top+30,right:_.right+15},1e3).fadeOut(100,function(){ajaxCart.updateCartInformation(o,e),$(this).remove()})):ajaxCart.updateCartInformation(o,e)},error:function(t,a,o){alert("Impossible to add the product to the cart.\n\ntextStatus: '"+a+"'\nerrorThrown: '"+o+"'\nresponseText:\n"+t.responseText),e?$("#add_to_cart input").removeAttr("disabled").addClass("exclusive").removeClass("exclusive_disabled"):$(i).removeAttr("disabled")}}))},remove:function(t,a,e,i){$.ajax({type:"POST",headers:{"cache-control":"no-cache"},url:baseUri+"?rand="+(new Date).getTime(),async:!0,cache:!1,dataType:"json",data:"controller=cart&delete=1&id_product="+t+"&ipa="+(null!=a&&parseInt(a)?a:"")+(e&&null!=e?"&id_customization="+e:"")+"&id_address_delivery="+i+"&token="+static_token+"&ajax=true",success:function(o){ajaxCart.updateCart(o),("order"==$("body").attr("id")||"order-opc"==$("body").attr("id"))&&deleteProductFromSummary(t+"_"+a+"_"+e+"_"+i)},error:function(){alert("ERROR: unable to delete the product")}})},hideOldProducts:function(t){if($("#cart_block_list dl.products").length>0){var a=null;$("#cart_block_list dl.products dt").each(function(){var e=$(this).attr("id"),i=e.replace("cart_block_product_",""),o=i.split("_"),r=!1;for(aProduct in t.products)t.products[aProduct].id!=o[0]||o[1]&&t.products[aProduct].idCombination!=o[1]||(r=!0,ajaxCart.hideOldProductCustomizations(t.products[aProduct],e));if(!r&&(a=$(this).attr("id"),null!=a)){var i=a.replace("cart_block_product_",""),o=i.split("_");$("#"+a).addClass("strike").fadeTo("slow",0,function(){$(this).slideUp("slow",function(){$(this).remove(),0==$("#cart_block dl.products dt").length&&($("#header #cart_block").stop(!0,!0).slideUp(200),$("#cart_block_no_products:hidden").slideDown(450),$("#cart_block dl.products").remove())})}),$("#cart_block_combination_of_"+o[0]+(o[1]?"_"+o[1]:"")+(o[2]?"_"+o[2]:"")).fadeTo("fast",0,function(){$(this).slideUp("fast",function(){$(this).remove()})})}})}},hideOldProductCustomizations:function(t,a){var e=$("#customization_"+t.id+"_"+t.idCombination);e.length>0&&$(e).find("li").each(function(){$(this).find("div").each(function(){var a=$(this).attr("id"),e=a.replace("deleteCustomizableProduct_",""),i=e.split("_");parseInt(t.idCombination)!=parseInt(i[2])||ajaxCart.doesCustomizationStillExist(t,i[0])||$("#"+a).parent().addClass("strike").fadeTo("slow",0,function(){$(this).slideUp("slow"),$(this).remove()})})});var i=$("#"+a).find(".ajax_cart_block_remove_link");t.hasCustomizedDatas||i.length||$("#"+a+" span.remove_link").html('<a class="ajax_cart_block_remove_link" rel="nofollow" href="'+baseUri+"?controller=cart&amp;delete=1&amp;id_product="+t.id+"&amp;ipa="+t.idCombination+"&amp;token="+static_token+'"> </a>'),t.is_gift&&$("#"+a+" span.remove_link").html("")},doesCustomizationStillExist:function(t,a){var e=!1;return $(t.customizedDatas).each(function(){return this.customizationId==a?(e=!0,!1):void 0}),e},refreshVouchers:function(t){if("undefined"==typeof t.discounts||0==t.discounts.length)$("#vouchers").hide();else{for($("#vouchers tbody").html(""),i=0;i<t.discounts.length;i++)if(parseFloat(t.discounts[i].price_float)>0){var a="";t.discounts[i].code.length&&(a='<a class="delete_voucher" href="'+t.discounts[i].link+'" title="'+delete_txt+'"><img src="'+img_dir+'icon/delete.gif" alt="'+delete_txt+'" class="icon" /></a>'),$("#vouchers tbody").append($('<tr class="bloc_cart_voucher" id="bloc_cart_voucher_'+t.discounts[i].id+'"><td class="quantity">1x</td><td class="name" title="'+t.discounts[i].description+'">'+t.discounts[i].name+'</td><td class="price">-'+t.discounts[i].price+'</td><td class="delete">'+a+"</td></tr>"))}$("#vouchers").show()}},updateProductQuantity:function(t,a){$("#cart_block_product_"+t.id+"_"+(t.idCombination?t.idCombination:"0")+"_"+(t.idAddressDelivery?t.idAddressDelivery:"0")+" .quantity").fadeTo("fast",0,function(){$(this).text(a),$(this).fadeTo("fast",1,function(){$(this).fadeTo("fast",0,function(){$(this).fadeTo("fast",1,function(){$(this).fadeTo("fast",0,function(){$(this).fadeTo("fast",1)})})})})})},displayNewProducts:function(t){$(t.products).each(function(){if(void 0!=this.id){0==$("#cart_block dl.products").length&&($("#cart_block_no_products").before('<dl class="products"></dl>'),$("#cart_block_no_products").hide());var t=this.id+"_"+(this.idCombination?this.idCombination:"0")+"_"+(this.idAddressDelivery?this.idAddressDelivery:"0"),a=this.id+"_"+(this.idCombination?this.idCombination:"0");if(0==$("#cart_block_product_"+t).length){var e=parseInt(this.id),i=(this.hasAttributes?parseInt(this.attributes):0,'<dt class="hidden" id="cart_block_product_'+t+'">');i+='<span class="quantity-formated"><span class="quantity">'+this.quantity+"</span>x</span>";var o=$("<span />").html(this.name).text();o=o.length>20?o.substring(0,20)+"...":o,i+='<a href="'+this.link+'" title="'+this.name+'" class="cart_block_product_name">'+o+"</a>",i+="undefined"==typeof this.is_gift||0==this.is_gift?'<span class="remove_link"><a rel="nofollow" class="ajax_cart_block_remove_link" href="'+baseUri+"?controller=cart&amp;delete=1&amp;id_product="+e+"&amp;token="+static_token+(this.hasAttributes?"&amp;ipa="+parseInt(this.idCombination):"")+'"> </a></span>':'<span class="remove_link"></span>',"undefined"!=typeof freeProductTranslation&&(i+='<span class="price">'+(parseFloat(this.price_float)>0?this.priceByLine:freeProductTranslation)+"</span>"),i+="</dt>",this.hasAttributes&&(i+='<dd id="cart_block_combination_of_'+t+'" class="hidden"><a href="'+this.link+'" title="'+this.name+'">'+this.attributes+"</a>"),this.hasCustomizedDatas&&(i+=ajaxCart.displayNewCustomizedDatas(this)),this.hasAttributes&&(i+="</dd>"),$("#cart_block dl.products").append(i)}else{var r=this;($.trim($("#cart_block_product_"+t+" .quantity").html())!=r.quantity||$.trim($("#cart_block_product_"+t+" .price").html())!=r.priceByLine)&&(this.is_gift?$("#cart_block_product_"+t+" .price").html(freeProductTranslation):$("#cart_block_product_"+t+" .price").text(r.priceByLine),ajaxCart.updateProductQuantity(r,r.quantity),r.hasCustomizedDatas&&(customizationFormatedDatas=ajaxCart.displayNewCustomizedDatas(r),$("#customization_"+a).length?($("#customization_"+a).html(""),$("#customization_"+a).append(customizationFormatedDatas)):r.hasAttributes?$("#cart_block_combination_of_"+t).append(customizationFormatedDatas):$("#cart_block dl.products").append(customizationFormatedDatas)))}$("#cart_block dl.products .hidden").slideDown(450).removeClass("hidden");var s=$("#cart_block_product_"+t).find("a.ajax_cart_block_remove_link");this.hasCustomizedDatas&&s.length&&$(s).each(function(){$(this).remove()})}})},displayNewCustomizedDatas:function(t){var a="",e=parseInt(t.id),i="undefined"==typeof t.idCombination?0:parseInt(t.idCombination),o=$("#customization_"+e+"_"+i).length;return o||(t.hasAttributes||(a+='<dd id="cart_block_combination_of_'+e+'" class="hidden">'),void 0==$("#customization_"+e+"_"+i).val()&&(a+='<ul class="cart_block_customizations" id="customization_'+e+"_"+i+'">')),$(t.customizedDatas).each(function(){var r=0;customizationId=parseInt(this.customizationId),i="undefined"==typeof t.idCombination?0:parseInt(t.idCombination),a+='<li name="customization"><div class="deleteCustomizableProduct" id="deleteCustomizableProduct_'+customizationId+"_"+e+"_"+(i?i:"0")+'"><a rel="nofollow" class="ajax_cart_block_remove_link" href="'+baseUri+"?controller=cart&amp;delete=1&amp;id_product="+e+"&amp;ipa="+i+"&amp;id_customization="+customizationId+"&amp;token="+static_token+'"></a></div><span class="quantity-formated"><span class="quantity">'+parseInt(this.quantity)+"</span>x</span>",$(this.datas).each(function(){this.type==CUSTOMIZE_TEXTFIELD&&$(this.datas).each(function(){return 0==this.index?(a+=" "+this.truncatedValue.replace(/<br \/>/g," "),r=1,!1):void 0})}),r||(a+=customizationIdMessage+customizationId),o||(a+="</li>"),customizationId&&($("#uploadable_files li div.customizationUploadBrowse img").remove(),$("#text_fields input").attr("value",""))}),o||(a+="</ul>",t.hasAttributes||(a+="</dd>")),a},updateCart:function(t){if(t.hasError){var a="";for(error in t.errors)"indexOf"!=error&&(a+=$("<div />").html(t.errors[error]).text()+"\n");alert(a)}else ajaxCart.updateCartEverywhere(t),ajaxCart.hideOldProducts(t),ajaxCart.displayNewProducts(t),ajaxCart.refreshVouchers(t),$("#cart_block .products dt").removeClass("first_item").removeClass("last_item").removeClass("item"),$("#cart_block .products dt:first").addClass("first_item"),$("#cart_block .products dt:not(:first,:last)").addClass("item"),$("#cart_block .products dt:last").addClass("last_item"),ajaxCart.overrideButtonsInThePage()},updateCartEverywhere:function(t){$(".ajax_cart_total").text($.trim(t.productTotal)),parseFloat(t.shippingCostFloat)>0||t.nbTotalProducts<1?$(".ajax_cart_shipping_cost").text(t.shippingCost):"undefined"!=typeof freeShippingTranslation&&$(".ajax_cart_shipping_cost").html(freeShippingTranslation),$(".ajax_cart_tax_cost").text(t.taxCost),$(".cart_block_wrapping_cost").text(t.wrappingCost),$(".ajax_block_cart_total").text(t.total),this.nb_total_products=t.nbTotalProducts,parseInt(t.nbTotalProducts)>0?($(".ajax_cart_no_product").hide(),$(".ajax_cart_quantity").text(t.nbTotalProducts),$(".ajax_cart_quantity").fadeIn("slow"),$(".ajax_cart_total").fadeIn("slow"),parseInt(t.nbTotalProducts)>1?($(".ajax_cart_product_txt").each(function(){$(this).hide()}),$(".ajax_cart_product_txt_s").each(function(){$(this).show()})):($(".ajax_cart_product_txt").each(function(){$(this).show()}),$(".ajax_cart_product_txt_s").each(function(){$(this).hide()}))):($(".ajax_cart_quantity, .ajax_cart_product_txt_s, .ajax_cart_product_txt, .ajax_cart_total").each(function(){$(this).hide()}),$(".ajax_cart_no_product").show("slow"))}};$(document).ready(function(){$("#block_cart_collapse").click(function(){ajaxCart.collapse()}),$("#block_cart_expand").click(function(){ajaxCart.expand()}),ajaxCart.overrideButtonsInThePage();var t=0,a=parseInt((new Date).getTime()/1e3);"undefined"==typeof $(".ajax_cart_quantity").html()||"undefined"!=typeof generated_date&&null!=generated_date&&parseInt(generated_date)+30<a?ajaxCart.refresh():t=parseInt($(".ajax_cart_quantity").html());var e=new HoverWatcher("#header #cart_block"),i=new HoverWatcher("#shopping_cart");$("#shopping_cart a:first").hover(function(){$(this).css("border-radius","3px 3px 0px 0px"),(ajaxCart.nb_total_products>0||t>0)&&$("#header #cart_block").stop(!0,!0).slideDown(450)},function(){$("#shopping_cart a").css("border-radius","3px"),setTimeout(function(){i.isHoveringOver()||e.isHoveringOver()||$("#header #cart_block").stop(!0,!0).slideUp(450)},200)}),$("#header #cart_block").hover(function(){$("#shopping_cart a").css("border-radius","3px 3px 0px 0px")},function(){$("#shopping_cart a").css("border-radius","3px"),setTimeout(function(){i.isHoveringOver()||$("#header #cart_block").stop(!0,!0).slideUp(450)},200)}),$(".delete_voucher").live("click",function(){return $.ajax({type:"POST",headers:{"cache-control":"no-cache"},async:!0,cache:!1,url:$(this).attr("href")+"?rand="+(new Date).getTime(),error:function(t,a,e){alert("TECHNICAL ERROR: \n\nDetails:\nError thrown: "+t+"\nText status: "+a)}}),$(this).parent().parent().remove(),("order"==$("body").attr("id")||"order-opc"==$("body").attr("id"))&&("undefined"!=typeof updateAddressSelection?updateAddressSelection():location.reload()),!1}),$("#cart_navigation input").click(function(){$(this).attr("disabled",!0).removeClass("exclusive").addClass("exclusive_disabled"),$(this).closest("form").get(0).submit()})});